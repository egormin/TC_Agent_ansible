- name: ===================== Install Java =====================
  yum:    
    name: java
    state: latest
  become: yes

- name: ===================== Install libselinux-python =====================
  yum:
    name: "{{item.package}}"
    state: latest
  with_items: 
    - { package: 'libselinux-python' }
    - { package: 'unzip' }
  become: yes

- name: ===================== Check if directory '{{buildAgent_path}}' exists =====================
  file:
    path: '{{buildAgent_path}}'
    state: directory
    mode: 0755
  become: yes

- name: ===================== Download build agent =====================
  unarchive:
    src: "{{TeamCity_url}}/update/buildAgent.zip"
    dest: '{{buildAgent_path}}'
    remote_src: yes
  become: yes

- name: ==================== buildAgent config copying =================
  template:
    src: buildagent_properties.j2
    dest: "{{buildAgent_path}}conf/buildAgent.properties"
  become: yes

- name: ==================== TC agent init script copying =================
  template:
    src: buildAgent.j2
    dest: "/etc/init.d/{{TCAgentService_name}}"
    mode: 0755
  become: yes

- name: ==================== TC agent start =================
  service:
    name: teamcity-agent
    state: started
  become: yes